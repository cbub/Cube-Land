namespace projectImages {
    //% fixedInstance
    export const Boss_2 = image.ofBuffer(hex`e4101000000000000000000000000000f0ff0f0000f0ffffff770f0000ff2222f277ff0f002f222222772ffff02f2222227727f2f022111122772722f022111f22772722f022f11f22772722f022f11f22772722f02f2222227727f2002f222222772fff00ff2222f277ff0f00f0ffffff770f0000000000f0ff0f000000000000000000`);
    //% fixedInstance
    export const Boss_Final = image.ofBuffer(hex`e41010005f0f00000000000055ff000000000000ff55ffffff0f0000f0555f55550fffff00ff5555550fffff00f055ff51ffff0f00f05fff51f5ff00005f555555f50f00005f555555f50f0000f05fff51f5ff0000f055ff51ffff0f00ff5555550ffffff0555f55550fffffff55ffffff0f000055ff0000000000005f0f000000000000`);
    //% fixedInstance
    export const Boy = image.ofBuffer(hex`e410100000000000ff0f0000000000f066ff0000000000f066f60000ffffffff66f60000cfccccff66f6ff0fcf1fccfc666666ffcfffcccc666666f6cfcccccc666666f6cfcccccc666666f6cfffcccc666666f6cf1fccfc666666ffcfccccff66f6ff0fffffffff66f60000000000f066f60000000000f066ff000000000000ff0f0000`);
    //% fixedInstance
    export const Chest_1 = image.ofBuffer(hex`e4101000ffffffffffffffffefeeeeefeeeeeefeefeeeeefceeceefeefccccefeecceefeefeefeffefceecfeefee5f55f5eeeefeefee5ff555efeefeefcc5ff55ff5eefeefee5ff55ff5ccfcefee5ff555cfeefeefee5f55f5eeeefeefccfeffefeeeefeefeecccfeeeeeefcefeeeeefeeccccfeefeeeeefeeeeeefeffffffffffffffff`);
    //% fixedInstance
    export const Chest = image.ofBuffer(hex`e4101000ffffffffffffffffefeeeeefeeeeeefeefeeeeefeeeeeefeefeeeeefeeeeeefeefeefeffefeeeefeefee7f77f7eeeefeefee7ff777efeefeefee7ff77ff7eefeefee7ff77ff7eefeefee7ff777efeefeefee7f77f7eeeefeefeefeffefeeeefeefeeeeefeeeeeefeefeeeeefeeeeeefeefeeeeefeeeeeefeffffffffffffffff`);
    //% fixedInstance
    export const Flag = image.ofBuffer(hex`e4101000000000000000ffff0000000000007ff70000000000007ff7ffffffffffff7ff77f777777777777f77f777777777777f7ff777777f2ff7ff7f0777777ff007ff7f07f77270f007ff7007f77270f007ff7007f77f20f007ff700ff77f200007ff200f0770f00002ff200f07f0f0000ffff0000ff0f000000000000000000000000`);
    //% fixedInstance
    export const Flower = image.ofBuffer(hex`e4101000005f55ff00000000005f33f50f000000005f7345ff00000000ff5544ff0f0000ffffff4f44ff00005ff5ffff44f4ff0f3f535f44ff4444ff3537354544444ff4353753f444ff44ff5f7335ffff44f40f5f33ff5f44f4ff00ff55ff3545ff0000f0ffff53f30f000000005f33550f000000005f37530f00000000ff5fff0f0000`);
    //% fixedInstance
    export const Gate = image.ofBuffer(hex`e410100000ff0f0000f0ff00f0ffffffffffff0fff0ff00ff00ff0ffff0000ffff0000ff0ff00ff00ff00ff0ffffff0000ffffff0fff00ffff00fff00f000000000000f00f000000000000f00fff00ffff00fff0ffffff0000ffffff0ff00ff00ff00ff0ff0000ffff0000ffff0ff00ff00ff0fff0ffffffffffff0f00ff0f0000f0ff00`);
    //% fixedInstance
    export const Girl = image.ofBuffer(hex`e410100000000000ff0f0000000000f033ff0000000000f033f30000ffffffff33f30000cfccccff33f3ff0fcf1fccfc333333ffcfffcccc333333f3cfcccccc333333f3cfcccccc333333f3cfffcccc333333f3cf1fccfc333333ffcfccccff33f3ff0fffffffff33f30000000000f033f30000000000f033ff000000000000ff0f0000`);
    //% fixedInstance
    export const Grass = image.ofBuffer(hex`e41010000000f0ff000000000000f0f6000000000000f0f6ff0000000000f066f60f000000f0ff6fd6ff0000ffff666666fdff0fff6666ff6f66660f6fd6fdffff6fff0f6ffdffff66660f00ffff006f66ff0f000000f06ff60f00000000ff66ff00000000006ff60f00000000006ffd000000000000ffff000000000000000000000000`);
    //% fixedInstance
    export const Stone_1 = image.ofBuffer(hex`e410100000f0ffffffff0f0000ffbbbbbfbbff00f0bfbbfbbfbbfb0fffbbfbbbbbbfbbffbfbbfbbbbbbffbfbbfffffbbffbffbffbffbbbbbbbbfbbffbfbbbbbbbbffbbfbbfbbfbbbbbbbbbfbbfbbbbffbfbbfffbbfffbbbbbfbbbffbbfbbbfbbbbbfbffbffbbffbbbbfbbbfff0bffbffbbbbfb0f00ffbbbbbbbbff0000f0ffffffff0f00`);
    //% fixedInstance
    export const Stone = image.ofBuffer(hex`e410100000ffffffffffff00f0dfddddddddfd0fffddd8d8d88dddffdf8ddfddfdddd8fddfdd888fddd8fdfd8f8dddddddddddfddfdfdfdddddd8ffddfddd88ddfd8ddfddfdddddddfdd8ffd8fdddddddd8dfdfddf8fd88ddfddd8fddfd8ddfd88ddddfddffdd8ddddffddfdffddfd8dd88dddfff0dfddddddddfd0f00ffffffffffff00`);
    //% fixedInstance
    export const Boss_1 = image.ofBuffer(hex`e4101000000000000000000000000000000000000000ffff0f00000000f0bbbbfb00000000bf1fbbbbffff0000bfffbbfbbbfb00f0bbffbb1bffff00f0bbbbbb1bf10000f0bbbbbb1bf10000f0bbffbb1bffff0000bfffbbfbbbfb0000bf1fbbbbffff0000f0bbbbfb0000000000ffff0f00000000000000000000000000000000000000`);
    //% fixedInstance
    export const Flower_2 = image.ofBuffer(hex`e41010000000fff70f00000000f07f77ff00000000f07766f700000000f07f76ff0f00000000ff4f44ff0000f0ffffff44f40f00ff774f444444ffff777647f4ff4444f47f6647fffffff4ff7f77f7ff4f44f400ff7ffff044f4ff0000ffffff44ff000000f07f47f40f000000f06776ff00000000f07f760f0000000000ffff0f000000`);
}
namespace palettes {
    //% fixedInstance
    export const palettehex = hex`000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`;
}

enum Kind {
    Girl,
    Boss,
    Chest,
    Boy
}

function introSequence() {
    game.showLongText("In a cube land far far away...", DialogLayout.Center);
    game.showLongText("There was a cubed lad and a cubed lady,      living     happily    ever      after.", DialogLayout.Center);
    let girl = sprites.create(projectImages.Girl.doubled());
    let boy = sprites.create(projectImages.Boy.doubled());
    scene.setBackgroundColor(9);
    music.baDing.play();
    girl.setPosition(50, 80);
    boy.setPosition(110, 80);
    game.waitAnyButton();
    game.showLongText("But       everything changed  when the cube lord attacked.", DialogLayout.Center);
    let boss = sprites.create(projectImages.Boss_Final.doubled());
    boss.setPosition(120, 47);
    game.waitAnyButton();
    boss.vx = 22;
    boy.vx = 22;
    boss.vy = -22;
    boy.vy = -22;
    girl.say("No! Leave him alone!");
    game.waitAnyButton();
    game.splash("I have to find him!");
    music.baDing.play();
}

function level1Setup() {
    scene.setBackgroundColor(9);
    scene.setTileMap(img`
        . . . . . . . . . . . . . . . . 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9
        . . . . . . . . . . . . . . . . 9 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9 . . . . . . 9
        . . . . . . . . . . . . . . . . 9 . . . . . . . . . . . . . 2 . . . . . . . . . . . 1 . . . . . 9 . . . . . . 9
        . . . . . . . . . . . . . . . . 9 . . 9 9 9 9 9 9 9 9 9 . . . . . 9 9 9 9 9 9 9 . . . . . 2 . . 9 . . . 2 . . 9
        . . . . . . . . . . . . . . . . 9 . 2 . . . . . . . . 9 . . . . . 9 . . . . . . . . . . . . . . . . . . . . . 9
        . . . . . . . . . . . . . . . . 9 . . . . . . . . . . 9 . 1 . . . 9 . . . . . . . . . . . . . . . . . 9 9 9 9 9
        9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 . . . 9 . . . . . 9 . . . 9 9 9 9 9 9 9 9 . . . . . . 9 . . . 9
        9 . . . 9 . . . . . . . 9 . . . . . . . . . . 9 . . . . . . . . . 9 . . . 9 . . . . . . . . . . . . . 9 . . . 9
        9 . . . 9 . . . 2 . . . 9 . . 2 . . . . . . . 9 . . . . . . . 2 . 9 . . . 9 . . . 1 . . . . . . . . . 9 . . . 9
        9 . . . 9 . . . . . . . 9 . . . 9 9 9 9 . . 9 9 . . . 9 . . . . . 9 . . . 9 . . . . . . . . . . . . . 9 . . . 9
        9 . 2 . 9 9 9 9 9 9 . . . . . . . . . . . . . 6 . 1 . 9 . . . . . 9 9 9 9 9 9 9 9 9 9 9 9 9 . . . 2 . 9 . . . 9
        9 . . . . . . . . . . . . . . . . . . . . . . 6 . . . 9 . . . . . 9 . . . . . . . . . . . 9 9 . . . . 9 . . . 9
        9 . . . . . 2 . . . . 1 . . 9 . . 9 . . . . 9 9 . . . 9 . . 1 . . 9 . 1 . . . . . . . . . 6 . . . . . . . . . 9
        9 . 1 . . . . . . . . . . . 9 . . 9 . . . . . 9 . . . 9 . . . . . 9 . . 9 9 9 9 9 9 9 . . 6 . . . . . . . . . 9
        9 . . . 9 . . 9 . . . . . . 9 . . 9 . . . 2 . 9 9 9 9 9 9 9 9 9 9 9 . . . . . . . . . . . 9 9 9 9 9 9 9 9 9 9 9
        9 . . . 9 . . 9 9 9 9 9 . . 9 . . 9 9 9 . . . 9 . . 9 4 . . . . . 9 . . . . 2 . . . . . . . . . . . . . . . . 9
        9 . 2 . 9 . . . . . . . . . 9 . . . . . . . . 9 . . 6 . . . . . . 9 . . . . . . . . . . . . . . 1 . . . . . . 9
        9 . . . 9 . . . . . 2 . . . 9 . . 1 . . . . . 9 . . 6 . . . . . . 9 . . . . 9 9 9 9 9 9 9 9 9 . . . . 9 . . . 9
        9 . . . 9 . . . . . . . . . 9 . . . . . . . . 9 9 9 9 4 . . . . . 9 . 1 . . . . . . . . . . 9 . . . . 9 . . . 9
        9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 . . . . . . 2 . . 9 . . . . . . . . . . . . 9 . . 2 . 9 . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . 1 . . . . . . . 9 . . 9 9 9 9 9 9 9 9 9 9 9 . . . . 9 . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . . . . . . . 9 . . . . . . . . . . . . . . . . . 9 . . 2 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 9 9 9 9 9 9 . . . . . . . . . . . . . . . . . 9 . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . . . . . . . . 2 . . . 9 9 9 9 9 9 9 9 . . . 9 . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . . . . . . . . . . . . 9 . . . . . . . . 1 . 9 . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . 2 . 9 . . 1 . . . 9 9 9 9 9 9 9 . . . . . . . . . . 9 . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . . . . . . . . . . . . 9 . . . 9 9 9 9 9 9 9 9 . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . . . . . . . 2 . . . . 9 . . . . . . . . . . . . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 9 9 9 9 9 . . . . . . . 9 . . . . . . . . . . . . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . . . . 9 . . . . . . . 9 . . . 9 9 9 9 9 9 9 . . 2 . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . . . . 9 . . . . . . . 9 . . . . . . . . . 9 . . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . 1 . . 9 . . . . . . . 9 . . . . . . . . . 9 . . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . . . . 9 . . . . . 2 . 9 . . . . . 9 . . . 9 . . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . . . . 9 . . . . . . . 9 . . . . . 9 . . . 9 . . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . 9 . . . . 9 . . . . . . . 9 . . . . . 9 9 9 9 9 . . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . 1 . . . . 2 . . . 1 . . . . . 9 . . 1 . . . . . . . . . 2 . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 . . . . . . . . . . . . . . . . 9 . . . . . . . . . . . . . . 9
        . . . . . . . . . . . . . . . . . . . . . . . 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9
        `);
    scene.setTile(9, projectImages.Stone, true);
    scene.setTile(6, projectImages.Gate);
    scene.setTile(3, projectImages.Boy);
    scene.setTile(2, projectImages.Flower);
    scene.setTile(1, projectImages.Flower_2);
    scene.setTile(4, projectImages.Flag);
    boySprite.setPosition(398, 268);
    girlSprite.setPosition(30, 200);
    boss1Sprite.setPosition(355, 178);
    bossFinalSprite.setPosition(445, 272);
    boss2Sprite.setPosition(748, 206);
    chest1Sprite.setPosition(96, 286);
    chest2Sprite.setPosition(355, 126);
    chest3Sprite.setPosition(355, 284);
    chest4Sprite.setPosition(870, 30);
    chest5Sprite.setPosition(870, 110);
    chest6Sprite.setPosition(300, 30);
    chest7Sprite.setPosition(624, 150);
    chest8Sprite.setPosition(778, 520);
    chest9Sprite.setPosition(720, 308);
    chest10Sprite.setPosition(460, 482);
    chest11Sprite.setPosition(864, 264);
    chest12Sprite.setPosition(512, 256);
}

sprites.onOverlap(Kind.Girl, Kind.Boss, function (mainSprite, hitSprite) {
    if (hitSprite == boss1Sprite) {
        if (chestsCollected == 0) {
            music.baDing.play();
            boss1Sprite.destroy();
            game.splash("You may pass!");
        }
        else {
            game.showLongText("Collect all the chests to pay the toll.", DialogLayout.Center);
            if (level == 1) {
                 girlSprite.setPosition(girlSprite.x - 5, girlSprite.y);
            }
        }
    }
    else if (hitSprite == boss2Sprite) {
        if (chestsCollected == 0) {
            music.baDing.play();
            boss2Sprite.destroy();
            game.splash("You may pass!");
        }
        else {
            game.showLongText("Collect all the chests to pay the toll.", DialogLayout.Center);
            if (level == 1) {
                girlSprite.setPosition(girlSprite.x + 5, girlSprite.y);
            }
        }
    }
    else {
        if (chestsCollected == 0) {
            music.baDing.play();
            bossFinalSprite.destroy();
            game.splash("You may pass!");
        }
        else {
            game.showLongText("Collect all the chests to pay the toll.", DialogLayout.Center);
            if (level == 1) {
                girlSprite.setPosition(girlSprite.x + 5, girlSprite.y);
            }
        }
    }
})

sprites.onOverlap(Kind.Girl, Kind.Chest, function (mainSprite, hitSprite) {
    chestsCollected++;
    music.baDing.play();
    hitSprite.destroy();
})

sprites.onOverlap(Kind.Girl, Kind.Boy, function (mainSprite, hitSprite) {
    music.baDing.play();
    game.splash("You are reunited!");
    game.showLongText("Your time to complete was: \n" + game.runtime() + "ms. Thanks for playing!", DialogLayout.Center);
    info.changeScoreBy(1800000 /* 30 minutes */ - game.runtime());
    game.over(true);
})


introSequence();

let boySprite = sprites.create(projectImages.Boy, Kind.Boy);
let girlSprite = sprites.create(projectImages.Girl, Kind.Girl);
let boss1Sprite = sprites.create(projectImages.Boss_1, Kind.Boss);
let boss2Sprite = sprites.create(projectImages.Boss_2, Kind.Boss);
let bossFinalSprite = sprites.create(projectImages.Boss_Final, Kind.Boss);
let chest1Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest2Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest3Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest4Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest5Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest6Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest7Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest8Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest9Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest10Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest11Sprite = sprites.create(projectImages.Chest, Kind.Chest);
let chest12Sprite = sprites.create(projectImages.Chest, Kind.Chest);

let level = Math.floor(Math.random() * 10)
switch(level) {
    case 1:
        level1Setup();
        break;
    default:
        level1Setup();
}
level1Setup();
let chestsCollected = 0;


girlSprite.setFlag(SpriteFlag.StayInScreen, true);
controller.moveSprite(girlSprite);
scene.cameraFollowSprite(girlSprite);


